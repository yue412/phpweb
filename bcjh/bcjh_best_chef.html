<html>

<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>
        爆炒江湖
    </title>
    <style type="text/css">
        div.no {
            font-size: 120%;
            display: inline
        }

        div.yes {
            font-size: 80%;
            display: inline
        }

        div.content {
            color: #FF0000;
            display: inline
        }

        div.level {
            display: inline
        }
    </style>
    <script type="text/javascript" src="common.js">
    </script>
    <script type="text/javascript" src="bcjh_data.js">
    </script>
    <script type="text/javascript" src="bcjh_common.js">
    </script>
    <script type="text/javascript" src="bcjh_skill.js">
    </script>
    <script type="text/javascript" src="TableSorterV3.js">
    </script>
    <script type="text/javascript">
        recipes = [];
        my_chefs = [];
        function get_best_chefs(recipe, chefs)
        {
            var result = [0, []];
            for (let i = 0; i < chefs.length; i++) {
                const chef = chefs[i];
                var price = calc_price(recipe, chef, my_chefs, 0);
                if (price > result[0])
                {
                    result[0] = price;
                    result[1].length = 0;
                    result[1].push(chef.name);
                }
                else if(price == result[0] && price > 0)
                {
                    result[1].push(chef.name);
                }
            }
            return result;
        }
        function display_price()
        {
            do_ajax("get_db_data.php?name=bcjh_recipes&order_field=id", function(text){
                var my_recipes = JSON.parse(text);
                do_ajax("get_db_data.php?name=bcjh_chefs&order_field=id", function(text){
                    var e = document.getElementById("price");
                    init_skills(g_bcjh_data.skills);
                    my_chefs = JSON.parse(text);
                    init_chefs(my_chefs);
                    recipes = build_recipes(g_bcjh_data.recipes, my_recipes, my_chefs);
                    recipes = filter_recipes_by_material(recipes);
                    //display_chefs(my_chefs);
                    var s = "<table id=\"tb2\" border='1'>";
                    s += "<tr>";
                    s += "<td>";
                    s += "ID";
                    s += "</td>";
                    s += "<td>";
                    s += "名称";
                    s += "</td>";
                    s += "<td>";
                    s += "总时间(秒)";
                    s += "</td>";
                    s += "<td>";
                    s += "总时间";
                    s += "</td>";
                    s += "<td>";
                    s += "总价";
                    s += "</td>";
                    s += "<td>";
                    s += "金币/小时";
                    s += "</td>";
                    s += "<td>";
                    s += "最牛厨师";
                    s += "</td>";
                    s += "</tr>";
                    for (let j = 0; j < recipes.length; j++) {
                        var recipe = recipes[j];
                        var total_time = recipe.limit * recipe.time;
                        var best = get_best_chefs(recipe, my_chefs);
                        s += "<tr>";
                        s += "<td>";
                        s += recipe.galleryId;
                        s += "</td>";
                        s += "<td>";
                        s += recipe.name;
                        s += "</td>";
                        s += "<td>";
                        s += total_time;
                        s += "</td>";
                        s += "<td>";
                        s += display_time(total_time);
                        s += "</td>";                        
                        s += "<td>";
                        s += best[0]*recipe.limit;
                        s += "</td>";
                        s += "<td>";
                        s += Math.ceil(best[0]/recipe.time*3600);
                        s += "</td>";
                        s += "<td>";
                        s += best[1].join(",");
                        s += "</td>";
                        s += "</tr>";
                    }
                    s += "</table>";
                    e.innerHTML = s;
                    var x = new TableSorter("tb2");
                });
            });
        }
        function filter_material()
        {
            var e = document.getElementById("f_material");
            g_filter_material = e.value;
            display_price();
        }        
    </script>
</head>
<body>
    <a href="bcjh_recipes.html">返回</a><br>
    菜：<input type="text" id="f_material"/><input type="button" value="过滤" onclick="filter_material()"/>
    <div id="price"></div>
    <script type="text/javascript">
        display_price();
    </script>
    
</body>

</html>